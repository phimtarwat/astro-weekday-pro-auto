name: Keep Vercel API Awake ðŸš€

on:
  schedule:
    - cron: "*/15 * * * *"      # à¸£à¸±à¸™à¸—à¸¸à¸ 15 à¸™à¸²à¸—à¸µ (à¹€à¸§à¸¥à¸² UTC)
  workflow_dispatch:             # à¸à¸”à¸£à¸±à¸™à¹€à¸­à¸‡à¹„à¸”à¹‰à¸ˆà¸²à¸à¸«à¸™à¹‰à¸² Actions

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping endpoints
        run: |
          set -e

          # à¸£à¸²à¸¢à¸à¸²à¸£ URL à¸—à¸µà¹ˆà¸ˆà¸°à¹€à¸£à¸µà¸¢à¸ (à¹€à¸žà¸´à¹ˆà¸¡/à¸¥à¸”à¹„à¸”à¹‰)
          URLS=(
            "https://astro-weekday-pro-auto.vercel.app/api/weekday?date=10/10/2568"
            "https://astro-weekday-pro-auto.vercel.app/api/weekday-th?date=10/10/2568"
            "https://astro-weekday-pro-auto.vercel.app/api/astro-chart?date=24/11/2514&time=11:00&lat=13.75&lon=100.5"
          )

          for u in "${URLS[@]}"; do
            echo "Pinging: $u"
            # timeout 15s, retry 3 à¸„à¸£à¸±à¹‰à¸‡, à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸° HTTP
            code=$(curl -m 15 --retry 3 --retry-delay 5 -sS -o /dev/null -w "%{http_code}" "$u")
            echo "Status: $code"
            # à¸–à¹‰à¸²à¹‚à¸„à¹‰à¸” >= 400 à¹ƒà¸«à¹‰ fail à¹€à¸žà¸·à¹ˆà¸­à¹€à¸«à¹‡à¸™à¹ƒà¸™ log
            if [ "$code" -ge 400 ]; then
              echo "Error: $u -> $code"
              exit 1
            fi
          done

          echo "All pings ok âœ…"
