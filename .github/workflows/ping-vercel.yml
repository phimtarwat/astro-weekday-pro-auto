name: Keep Vercel API Awake üöÄ

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Print current time (Thai timezone)
        run: |
          echo "üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Asia/Bangkok):"
          TZ=Asia/Bangkok date

      - name: Ping Vercel endpoints
        run: |
          echo "üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Ping API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..."
          
          BASE_URL="https://astro-weekday-pro-auto.vercel.app"

          ENDPOINTS=(
            "/api/weekday?date=10/10/2568"
            "/api/weekday-th?date=10/10/2568"
            "/api/astro-chart?date=10/10/2568&time=12:00&lat=13.75&lon=100.5"
            "/api/astro-match?date1=10/10/2568&date2=15/05/2568"
          )

          FAIL_COUNT=0

          for ENDPOINT in "${ENDPOINTS[@]}"; do
            echo ""
            echo "üåê Checking: ${BASE_URL}${ENDPOINT}"
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" "${BASE_URL}${ENDPOINT}")
            
            if [ "$STATUS" -eq 200 ]; then
              echo "‚úÖ Status: 200 OK"
            else
              echo "‚ùå Status: ${STATUS}"
              ((FAIL_COUNT++))
            fi
          done

          echo ""
          echo "üìä ‡∏™‡∏£‡∏∏‡∏õ: ‡∏°‡∏µ ${FAIL_COUNT} endpoint ‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥"

          if [ "$FAIL_COUNT" -eq 0 ]; then
            echo "üéâ All endpoints responded successfully!"
          else
            echo "‚ö†Ô∏è ‡∏ö‡∏≤‡∏á endpoint ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô)"
          fi
